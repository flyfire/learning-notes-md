# 04.强引用、软引用、弱引用、幻象引用有什么区别？

不同的引用类型，主要体现的是对象不同的可达性（reachable）状态和对垃圾收集的影响。

所谓强引用（strong reference）,就是我们最常见的普通对象引用，只要还有强引用指向一个对象，就能表明对象还”活着“，垃圾收集器不会碰这种对象。对于一个普通的对象，如果没有其他的引用关系，只要超过了引用的作用域或者显式地将相应强引用赋值为null，就是可以被垃圾收集的了，当然具体回收时机还是要看垃圾收集策略。

软引用（SoftReference），是一种相对强引用弱化一些的引用，可以让对象豁免一些垃圾收集，只有当JVM认为内存不足时，才会去试图回收软引用指向的对象。JVM会确保在抛出OutOfMemoryError之前，清理软引用指向的对象。软引用通常用来实现内存敏感的缓存，如果还有空闲内存，就可以暂时保留缓存，当内存不足时清理掉，这样就保证了使用缓存的同时，不会耗尽内存。

弱引用（WeakReference）并不能使对象豁免垃圾收集，仅仅是提供一种访问在弱引用状态下对象的途径。这就可以用来构建一种没有特定约束的关系，比如，维护一种非强制性的映射关系，如果试图获取时对象还在，就使用它，否则重新实例化。它同样是很多缓存实现的选择。

对于幻象引用，有时候也翻译成虚引用，你不能通过它访问对象。幻象引用仅仅是提供了一种确保对象被finalize以后，做某些事情的机制，比如，通常用来做所谓的post-mortem清理机制。也有人用幻象引用监控对象的创建和销毁。

Java定义的不同可达性级别(reachability level)

+ 强可达（strongly reachable），就是当一个对象可以有一个或多个线程可以不通过各种引用访问到的情况。比如，我们新创建一个对象，那么创建它的线程对它就是强可达。
+ 软可达（softly reachable）,就是当我们只能通过软引用才能访问到对象的状态。
+ 弱可达（weakly reachable），类似前面提到的，就是无法通过强引用或者软引用访问，只能通过弱引用访问时的状态。这是十分临近finalize状态的时机，当弱引用被清除的时候，就符合finalize的条件了。
+ 幻象可达（phantom reachable），就是没有强，软，弱引用关联，并且finalize过了，只有幻象引用指向这个对象的时候。
+ 不可达（unreachable），意味着对象可以被清除了。

所有引用类型，都是抽象类``java.lang.ref.Reference``的子类，它提供了``get()``方法，除了幻象引用（get永远返回null）,如果对象还没有被销毁，都可以通过get方法获取原有对象，这意味着，利用软引用和弱引用，可以将访问到的对象，重新指向强引用。

在创建各种引用并关联到响应对象时，可以选择是否需要关联引用队列，JVM会在特定时机将引用enqueue到队列里，可以从队列里获取引用进行相关后续逻辑。

``Reference.reachabilityFence(this);``